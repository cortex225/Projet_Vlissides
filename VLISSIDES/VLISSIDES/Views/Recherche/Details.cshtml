@model VLISSIDES.ViewModels.Recherche.DetailsLivreVM
@{
}


<link rel="stylesheet" href="~/css/Details.css">
<div id="detailsDivPrincipal">
    <div id="DetailsDIV">
        <img id="DetailsIMG" src="@Model.Couverture"/>
    </div>

    <div id="DetailsInfo">
        <h2>@Model.Titre</h2>

        <div id="checkboxTypeLivre">

        </div>
        @if (Model.LivreTypeLivres.Count <= 0)
        {
            <p>
                <strong>Aucun Prix</strong>
            </p>
        }
        else
        {
            @foreach (var t in Model.LivreTypeLivres)
            {
                @if (t.TypeLivre.Nom == "Neuf")
                {
                    <p>Prix neuf: @t.Prix $</p>
                }
                @if (t.TypeLivre.Nom == "Numérique")
                {
                    <p>Prix numérique: @t.Prix $</p>
                }
            }
        }
        <p>Auteur(s): @Model.lAuteur.NomAuteur </p>
        <p>Catégorie(s): @Model.laCategorie.Nom </p>
        <p>Date publication: @Model.DatePublication</p>
        <p>Éditeur: @Model.maisonEdition.Nom</p>
        <p>Nombre de pages: @Model.NbPages</p>
        <strong>Résumé:</strong>
        <p>@Model.Resume</p>
        <br/>
        @if (Model.NbExemplaires > 0)
        {
            <p style="font-weight: bold;">En stock (@Model.NbExemplaires restants)</p>
        }
        else
        {
            <p style="font-weight: bold; color: red;">En rupture de stock</p>
        }
    </div>
</div>

<form asp-action="AjouterAuPanier" asp-controller="GestionCommande" method="post">
    <input type="hidden" name="livreId" value="@Model.Id" />
    <input type="number" name="quantite" value="1" min="1" />
    <select name="typeLivreId">
        @foreach (var type in Model.listTypeLivres)
        {
            <option value="@type.Id">@type.Nom</option>
        }
    </select>
    <button type="submit">Ajouter au panier</button>
</form>

<button id="checkout-button">Checkout</button>

<script type="text/javascript">
     var checkoutButton = document.getElementById('checkout-button');
 
     checkoutButton.addEventListener('click', function () {
         fetch('/GestionCommande/CreateCheckoutSession', {
             method: 'POST',
         })
         .then(function (response) {
             return response.json();
         })
         .then(function (session) {
             return stripe.redirectToCheckout({ sessionId: session.id });
         })
         .then(function (result) {
             if (result.error) {
                 alert(result.error.message);
             }
         })
         .catch(function (error) {
             console.error('Error:', error);
         });
     });
 </script>
<script src="https://js.stripe.com/v3/" asp-append-version="true"></script>




<style>
    #DetailsDIV{
        max-width: 35%;
    }

    #DetailsIMG {
        max-width: 100%;
    }
</style>